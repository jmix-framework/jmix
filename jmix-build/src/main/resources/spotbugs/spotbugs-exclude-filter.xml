<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2019 Haulmont.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<FindBugsFilter>
    <!-- Disabled bug patterns -->

    <Match>
        <Bug pattern="MS_SHOULD_BE_FINAL"/>
    </Match>
    <Match>
        <Bug pattern="SQL_PREPARED_STATEMENT_GENERATED_FROM_NONCONSTANT_STRING"/>
    </Match>
    <Match>
        <Bug pattern="SE_COMPARATOR_SHOULD_BE_SERIALIZABLE"/>
    </Match>
    <Match>
        <Bug pattern="VA_FORMAT_STRING_USES_NEWLINE"/> <!-- We do not use platform specific new line characters -->
    </Match>
    <Match>
        <Bug pattern="DP_CREATE_CLASSLOADER_INSIDE_DO_PRIVILEGED"/> <!-- We do not support Java SecurityManager -->
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>
    <Match>
        <Bug pattern="SE_BAD_FIELD"/> <!-- We do not check serializable fields in UI components -->
    </Match>
    <Match>
        <Bug pattern="MC_OVERRIDABLE_METHOD_CALL_IN_CLONE"/>
    </Match>
    <Match>
        <Or>
            <Bug pattern="THROWS_METHOD_THROWS_RUNTIMEEXCEPTION"/>
            <Bug pattern="THROWS_METHOD_THROWS_CLAUSE_BASIC_EXCEPTION"/>
            <Bug pattern="THROWS_METHOD_THROWS_CLAUSE_THROWABLE"/>
        </Or>
    </Match>

    <!-- False positives (since Java 11) -->
    <Match>
        <Class name="io.jmix.core.impl.ResourcesImpl"/>
        <Method name="getResourceAsString"/>
        <Bug pattern="NP_LOAD_OF_KNOWN_NULL_VALUE"/>
    </Match>
    <Match>
        <Class name="io.jmix.ui.sys.vaadin.JmixUIProvider"/>
        <Method name="getWidgetsetInfo"/>
        <Bug pattern="NP_LOAD_OF_KNOWN_NULL_VALUE"/>
    </Match>
    <Match>
        <Class name="io.jmix.bpmui.screen.dmndecisiontable.DmnDecisionTableBrowse"/>
        <Bug pattern="NP_LOAD_OF_KNOWN_NULL_VALUE"/>
    </Match>
    <Match>
        <Class name="io.jmix.bpmui.screen.processdefinition.ProcessDefinitionBrowse"/>
        <Bug pattern="NP_LOAD_OF_KNOWN_NULL_VALUE"/>
    </Match>
    <Match>
        <Bug pattern="UC_USELESS_OBJECT"/>
        <Class name="io.jmix.bpmui.screen.modeler.properties.entitydatatask.entityattribute.EntityAttributesFragment"/>
        <Method name="entityAttributesTableExcludeEnabledRule"/>
    </Match>
    <Match>
        <Class name="io.jmix.securityui.screen.rowlevelpolicy.RowLevelPolicyModelEdit"/>
        <Method name="onTestBtnClick"/>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
    </Match>

    <!-- Ignored CUBA compatibility module -->
    <Match>
        <Package name="~com\.haulmont.*"/>
    </Match>

    <!-- Ignored UI widgets -->
    <Match>
        <Package name="~io\.jmix\.ui\.widget\.client.*"/>
    </Match>

    <!-- Ignored autogenerated code -->
    <Match>
        <Package name="io.jmix.data.impl.jpql.antlr2"/>
    </Match>

    <!-- todo Temporarily ignored GraphQL module -->
    <Match>
        <Package name="~io\.jmix\.graphql.*"/>
    </Match>

    <!-- todo Temporarily ignored UI testassist module -->
    <Match>
        <Package name="~io\.jmix\.ui\.testassist.*"/>
    </Match>

    <!-- todo Temporarily ignored FlowUI module -->
    <Match>
        <Package name="~io\.jmix\.flowui.*"/>
    </Match>

    <!-- Ignored problems in classes -->

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/>
        <Class name="io.jmix.core.impl.CorePersistentAttributesLoadChecker"/>
        <Method name="checkIsLoadedWithGetter"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/>
        <Class name="io.jmix.notifications.channel.impl.InAppNotificationChannel"/>
        <Method name="init"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/>
        <Class name="io.jmix.notificationsflowui.view.inappnotification.InAppNotificationDetailView"/>
        <Method name="onRecipientsFieldFetchCallback"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/>
        <Class name="io.jmix.notificationsflowui.view.createnotification.CreateNotificationDialog"/>
        <Method name="onRecipientsFieldFetchCallback"/>
    </Match>

    <Match>
        <Bug pattern="URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD"/>
        <Class name="io.jmix.data.impl.jpql.EntityPath"/>
    </Match>

    <Match>
        <Bug pattern="SE_TRANSIENT_FIELD_NOT_RESTORED"/>
        <Or>
            <Class name="io.jmix.ui.model.impl.ObservableList"/>
            <Class name="io.jmix.ui.model.impl.ObservableSet"/>
        </Or>
    </Match>

    <Match>
        <Bug pattern="MS_EXPOSE_REP"/>
        <Class name="io.jmix.reports.ReportPrintHelper"/>
    </Match>

    <Match>
        <Bug pattern="MF_CLASS_MASKS_FIELD"/>
        <Class name="io.jmix.dynattr.impl.DynAttrMetaProperty"/>
    </Match>

    <Match>
        <Bug pattern="SSD_DO_NOT_USE_INSTANCE_LOCK_ON_SHARED_STATIC_DATA"/>
        <Class name="io.jmix.reportsui.screen.report.wizard.template.generators.HtmlGenerator"/>
    </Match>

    <!--  Nullability  -->

    <Match>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE"/>
    </Match>

    <Match>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_OF_NULL_VALUE"/>
    </Match>

    <Match>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE"/>
    </Match>

    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="io.jmix.data.impl.JmixTransactionManager"/>
    </Match>

    <Match>
        <Bug pattern="MS_PKGPROTECT"/>
        <Class name="io.jmix.ui.navigation.CrockfordUuidEncoder"/>
    </Match>

    <Match>
        <Bug pattern="URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD"/>
        <Class name="io.jmix.ui.sys.FragmentsImpl"/>
    </Match>

    <Match>
        <Bug pattern="NP_NONNULL_PARAM_VIOLATION"/>
        <Class name="io.jmix.ui.component.impl.AbstractDataGrid$ActionMenuItemWrapper"/>
        <Method name="performAction"/>
    </Match>

    <Match>
        <Bug pattern="NP_NONNULL_PARAM_VIOLATION"/>
        <Class name="io.jmix.ui.component.presentation.TablePresentations"/>
        <Method name="setPopupButtonAction"/>
    </Match>


    <!--  Do not analyze equals() method in all jmix entities  -->
    <Match>
        <Bug pattern="NP_EQUALS_SHOULD_HANDLE_NULL_ARGUMENT"/>
        <Package name="~io\.jmix\..*\.entity.*"/>
    </Match>

    <Match>
        <Bug pattern="NP_PARAMETER_MUST_BE_NONNULL_BUT_MARKED_AS_NULLABLE"/>
        <Class name="~.*\$JmixEntityEntry"/>
    </Match>


    <!--  todo fix  -->
    <Match>
        <Bug pattern="NP_EQUALS_SHOULD_HANDLE_NULL_ARGUMENT"/>
        <Package name="io.jmix.data.entity"/>
    </Match>

    <Match>
        <Bug code="NP,RCN"/>
        <Or>
            <!-- ... -->
        </Or>
    </Match>

    <!--  todo Fix next Match. It is added here because in many places we have something like this:
    if (a.getB() != null) {
        doSmth(a.getB());
    }
    Spotbugs consider it an error.
    The following works:
    B b = a.getB();
    if (b != null) {
        doSmth(b);
    }
    -->
    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
    </Match>

    <!-- Bad practice detected in EclipseLink generated code -->

    <Match>
        <Bug pattern="ES_COMPARING_PARAMETER_STRING_WITH_EQ"/>
        <Method name="_persistence_get"/>
    </Match>

    <Match>
        <Bug pattern="ES_COMPARING_PARAMETER_STRING_WITH_EQ"/>
        <Method name="_persistence_set"/>
    </Match>

    <Match>
        <Bug pattern="EI_EXPOSE_REP"/>
        <Method name="_persistence_get"/>
    </Match>

    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Method name="_persistence_set"/>
    </Match>

    <Match>
        <Bug pattern="NP_BOOLEAN_RETURN_NULL"/>
        <Class name="io.jmix.core.metamodel.datatype.impl.BooleanDatatype"/>
        <Method name="parse"/>
    </Match>

    <Match>
        <Class name="com.haulmont.cuba.core.config.ConfigGetter"/>
        <Bug pattern="ES_COMPARING_PARAMETER_STRING_WITH_EQ"/>
    </Match>

    <Match>
        <Bug pattern="DM_STRING_VOID_CTOR"/>
        <Class name="com.haulmont.cuba.core.config.ConfigUtil"/>
    </Match>

    <Match>
        <Bug pattern="SF_SWITCH_FALLTHROUGH"/>
        <Class name="io.jmix.core.UuidProvider"/>
    </Match>

    <Match>
        <Bug pattern="CN_IDIOM_NO_SUPER_CALL"/>
        <Class name="io.jmix.eclipselink.impl.DescriptorEventManagerWrapper"/>
    </Match>

    <Match>
        <Bug pattern="SE_TRANSIENT_FIELD_NOT_RESTORED"/>
        <Class name="io.jmix.eclipselink.impl.entitycache.QueryKey"/>
    </Match>

    <Match>
        <Bug pattern="SE_NO_SERIALVERSIONID"/>
        <Class name="io.jmix.eclipselink.impl.entitycache.QueryKey"/>
    </Match>

    <Match>
        <Bug pattern="BC_VACUOUS_INSTANCEOF"/>
        <Class name="io.jmix.data.PersistenceTools"/>
    </Match>

    <Match>
        <Bug pattern="EQ_DOESNT_OVERRIDE_EQUALS"/>
        <Class name="io.jmix.eclipselink.impl.support.JmixIsNullExpressionOperator"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/> <!-- false positive -->
        <Class name="io.jmix.ui.component.impl.EditorScreenFacetImpl"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/> <!-- false positive -->
        <Class name="io.jmix.ui.component.impl.LookupScreenFacetImpl"/>
    </Match>

    <Match>
        <Bug pattern="UWF_UNWRITTEN_PUBLIC_OR_PROTECTED_FIELD"/>
        <Class name="~io\.jmix\.pivottable\.screen\.PivotTableFragment\$.*"/>
    </Match>

    <Match>
        <Bug pattern="MS_PKGPROTECT"/>
        <Class name="io.jmix.charts.widget.client.amcharts.JmixAmchartsJsOverlay"/>
    </Match>

    <Match>
        <Bug pattern="URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD"/>
        <Class name="~io\.jmix\.reportsrest\.controller\.ReportRestControllerManager\$.*"/>
    </Match>

    <Match>
        <Bug pattern="UWF_UNWRITTEN_PUBLIC_OR_PROTECTED_FIELD"/>
        <Class name="~io\.jmix\.reportsrest\.controller\.ReportRestControllerManager\$.*"/>
    </Match>

    <Match>
        <Bug pattern="NM_SAME_SIMPLE_NAME_AS_INTERFACE"/>
        <Or>
            <Class name="io.jmix.reports.entity.Report"/>
            <Class name="io.jmix.reports.entity.ReportTemplate"/>
        </Or>
    </Match>

    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="io.jmix.reports.impl.ReportsPersistenceImpl"/>
        <Method name="save"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED"/>
        <Class name="io.jmix.emailtemplatesui.screen.emailtemplate.report.ReportEmailTemplateEdit"/>
        <Method name="onPreCommit"/>
    </Match>

    <Match>
        <Bug pattern="UWF_UNWRITTEN_FIELD"/>
        <Package name="io.jmix.bpm.delegate"/>
    </Match>

    <Match>
        <Bug pattern="RV_RETURN_VALUE_IGNORED"/>
        <Class name="io.jmix.datatoolsui.screen.entityinspector.EntityInspectorEditor"/>
        <Method name="afterCommit"/>
    </Match>

    <Match>
        <Bug pattern="SF_SWITCH_NO_DEFAULT"/>
        <Class name="io.jmix.datatoolsui.screen.entityinspector.assistant.InspectorFetchPlanBuilder"/>
        <Method name="build"/>
    </Match>

    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="io.jmix.ui.model.impl.ObservableList"/>
        <Method name="sort"/>
    </Match>

    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="io.jmix.reportsui.screen.report.run.ParameterFieldCreator"/>
        <Method name="createField"/>
    </Match>

    <Match>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
        <Class name="io.jmix.reportsui.screen.report.wizard.OutputFormatTools"/>
        <Method name="getOutputAvailableFormats"/>
    </Match>

    <Match>
        <Bug pattern="SBSC_USE_STRINGBUFFER_CONCATENATION"/>
        <Class name="name.fraser.neil.plaintext.diff_match_patch"/>
    </Match>

</FindBugsFilter>
